var c=EventTarget,f="https://embed.foxglove.dev/",d=[".bag",".mcap"],r=class extends c{#e;#n;#r;#s=!1;#t={dataSource:void 0,layout:void 0,extension:[]};#i=!1;constructor(e){super();let{parent:t,src:n,orgSlug:a,initialDataSource:o,initialLayout:s,initialExtensions:h,colorScheme:u="auto"}=e;this.#r=a;let l=n??f;try{this.#n=new URL(l)}catch{throw new Error(`[FoxgloveViewer] Invalid server URL: ${l}`)}window.addEventListener("message",this.#h),o&&this.setDataSource(o),s!=null&&this.setLayoutData(s),h&&this.installExtensions(h),this.#e=document.createElement("iframe"),this.#e.src=l,this.#e.title="Foxglove",this.#e.allow="cross-origin-isolated",this.#e.style.width="100%",this.#e.style.height="100%",this.#e.style.border="none",this.setColorScheme(u),t.appendChild(this.#e)}setDataSource(e){if(e.type==="live"){let t=this.#d(e.protocol,e.url);if(t)throw new Error(`[FoxgloveViewer] Error setting data source: ${t}`)}this.#a({type:"set-data-source",payload:e})}setLayoutData(e){this.#a({type:"set-layout",payload:e})}installExtensions(e){let t=e.find(n=>this.#l(n));if(t!=null)throw new Error(`[FoxgloveViewer] Error installing extension: ${this.#l(t)}`);this.#a({type:"install-extension",payload:e})}isReady(){return this.#s}destroy(){this.#i=!0,this.#e.remove(),window.removeEventListener("message",this.#h)}isDestroyed(){return this.#i}setColorScheme(e){this.#e.style.colorScheme=e==="auto"?"normal":e}#a(e){e.type==="install-extension"?this.#t.extension.push(e):e.type==="set-data-source"?this.#t.dataSource=e:this.#t.layout=e,this.#s&&this.#o(e)}#o(e){if(this.#i){console.warn("[FoxgloveViewer] Unable to post command. Frame has been destroyed.");return}p(this.#e.contentWindow,"Invariant: iframe should be loaded."),this.#e.contentWindow.postMessage(e,this.#n.href)}#d(e,t){switch(e){case"foxglove-websocket":case"rosbridge-websocket":return!t.startsWith("ws://")&&!t.startsWith("wss://")?"Invalid URL. The URL must start with ws:// or wss://.":void 0;case"remote-file":try{let n=t.split(".").pop();return!n||n.length===0?"Invalid URL. The URL must end with a filename and extension.":d.includes(`.${n}`)?void 0:`Invalid URL. Only ${new Intl.ListFormat("en-US",{style:"long"}).format(d)} files are supported.`}catch{return"Invalid URL."}}}#l(e){if(typeof e=="string"){let t=e.split(".").pop();if(!t||t.length===0)return"Invalid URL. The URL must end with a filename and extension.";if(t!=="foxe")return"Invalid extension. The extension must be a .foxe file."}else{let t=e.name.split(".").pop();if(!t||t.length===0||t!=="foxe")return"Invalid extension. The extension must be a .foxe file."}}#h=e=>{let t=new URL(e.origin);if(!(e.source!==this.#e.contentWindow||t.href!==this.#n.href)){if(this.#i){console.warn("[FoxgloveViewer] Unable to handle message. Frame has been destroyed.");return}switch(e.data.type){case"foxglove-origin-request":this.#o({type:"origin-ack"});break;case"foxglove-handshake-request":{this.#s=!0,this.#o({type:"handshake-ack",payload:{orgSlug:this.#r,initialDataSource:this.#t.dataSource?.payload,initialLayout:this.#t.layout?.payload,initialExtensions:this.#t.extension.flatMap(n=>n.payload)}});break}case"foxglove-handshake-complete":{this.dispatchEvent(new Event("ready"));break}case"foxglove-error":{this.dispatchEvent(new CustomEvent("error",{detail:e.data.payload}));break}default:{console.warn("[FoxgloveViewer] Unhandled message type:",e.data);break}}}}};function p(i,e="no additional info provided"){if(!i)throw new Error("Assertion Error: "+e)}function g({model:i,el:e}){function t(){let s=i.get("_data");return{type:"file",file:new File([s.buffer],"data.mcap")}}function n(){let s=i.get("layout_data");return JSON.stringify(s)!=="{}"?s:void 0}let a=document.createElement("div"),o=new r({parent:a,src:i.get("src")!==""?i.get("src"):void 0,orgSlug:void 0,initialDataSource:t(),initialLayout:n()});a.style.width=i.get("width"),a.style.height=i.get("height"),i.on("change:width",()=>{a.style.width=i.get("width")}),i.on("change:height",()=>{a.style.height=i.get("height")}),i.on("change:_data",()=>{let s=t();o.setDataSource(s)}),i.on("change:layout",()=>{let s=n();o.setLayoutData(s)}),e.appendChild(a)}var L={render:g};export{L as default};

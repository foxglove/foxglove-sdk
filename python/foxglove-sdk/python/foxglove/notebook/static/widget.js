var c=EventTarget,f="https://embed.foxglove.dev/",u=[".bag",".mcap"],d=class extends c{#e;#s;#r;#n=!1;#t={dataSource:void 0,layout:void 0,extension:[]};#i=!1;constructor(e){super();let{parent:t,src:i,orgSlug:a,initialDataSource:n,initialLayout:r,initialExtensions:l,colorScheme:h="auto"}=e;this.#r=a;let o=i??f;try{this.#s=new URL(o)}catch{throw new Error(`[FoxgloveViewer] Invalid server URL: ${o}`)}window.addEventListener("message",this.#d),n&&this.setDataSource(n),r!=null&&this.setLayoutData(r),l&&this.installExtensions(l),this.#e=document.createElement("iframe"),this.#e.src=o,this.#e.title="Foxglove",this.#e.allow="cross-origin-isolated",this.#e.style.width="100%",this.#e.style.height="100%",this.#e.style.border="none",this.setColorScheme(h),t.appendChild(this.#e)}setDataSource(e){if(e.type==="live"){let t=this.#h(e.protocol,e.url);if(t)throw new Error(`[FoxgloveViewer] Error setting data source: ${t}`)}this.#a({type:"set-data-source",payload:e})}setLayoutData(e){this.#a({type:"set-layout",payload:e})}installExtensions(e){let t=e.find(i=>this.#l(i));if(t!=null)throw new Error(`[FoxgloveViewer] Error installing extension: ${this.#l(t)}`);this.#a({type:"install-extension",payload:e})}isReady(){return this.#n}destroy(){this.#i=!0,this.#e.remove(),window.removeEventListener("message",this.#d)}isDestroyed(){return this.#i}setColorScheme(e){this.#e.style.colorScheme=e==="auto"?"normal":e}#a(e){e.type==="install-extension"?this.#t.extension.push(e):e.type==="set-data-source"?this.#t.dataSource=e:this.#t.layout=e,this.#n&&this.#o(e)}#o(e){if(this.#i){console.warn("[FoxgloveViewer] Unable to post command. Frame has been destroyed.");return}p(this.#e.contentWindow,"Invariant: iframe should be loaded."),this.#e.contentWindow.postMessage(e,this.#s.href)}#h(e,t){switch(e){case"foxglove-websocket":case"rosbridge-websocket":return!t.startsWith("ws://")&&!t.startsWith("wss://")?"Invalid URL. The URL must start with ws:// or wss://.":void 0;case"remote-file":try{let i=t.split(".").pop();return!i||i.length===0?"Invalid URL. The URL must end with a filename and extension.":u.includes(`.${i}`)?void 0:`Invalid URL. Only ${new Intl.ListFormat("en-US",{style:"long"}).format(u)} files are supported.`}catch{return"Invalid URL."}}}#l(e){if(typeof e=="string"){let t=e.split(".").pop();if(!t||t.length===0)return"Invalid URL. The URL must end with a filename and extension.";if(t!=="foxe")return"Invalid extension. The extension must be a .foxe file."}else{let t=e.name.split(".").pop();if(!t||t.length===0||t!=="foxe")return"Invalid extension. The extension must be a .foxe file."}}#d=e=>{let t=new URL(e.origin);if(!(e.source!==this.#e.contentWindow||t.href!==this.#s.href)){if(this.#i){console.warn("[FoxgloveViewer] Unable to handle message. Frame has been destroyed.");return}switch(e.data.type){case"foxglove-origin-request":this.#o({type:"origin-ack"});break;case"foxglove-handshake-request":{this.#n=!0,this.#o({type:"handshake-ack",payload:{orgSlug:this.#r,initialDataSource:this.#t.dataSource?.payload,initialLayout:this.#t.layout?.payload,initialExtensions:this.#t.extension.flatMap(i=>i.payload)}});break}case"foxglove-handshake-complete":{this.dispatchEvent(new Event("ready"));break}case"foxglove-error":{this.dispatchEvent(new CustomEvent("error",{detail:e.data.payload}));break}default:{console.warn("[FoxgloveViewer] Unhandled message type:",e.data);break}}}}};function p(s,e="no additional info provided"){if(!s)throw new Error("Assertion Error: "+e)}function y({model:s,el:e}){function t(){let n=s.get("layout_data");return JSON.stringify(n)!=="{}"?n:void 0}let i=document.createElement("div"),a=new d({parent:i,src:s.get("src")!==""?s.get("src"):void 0,orgSlug:void 0,initialLayout:t()});a.addEventListener("ready",()=>{s.send({type:"ready"})}),s.on("msg:custom",(n,r)=>{if(n.type==="update-data"){let l=r.map((h,o)=>new File([h.buffer],`data-${o}.mcap`));a.setDataSource({type:"file",file:l})}}),i.style.width=s.get("width"),i.style.height=s.get("height"),s.on("change:width",()=>{i.style.width=s.get("width")}),s.on("change:height",()=>{i.style.height=s.get("height")}),s.on("change:layout",()=>{let n=t();a.setLayoutData(n)}),e.appendChild(i)}var L={render:y};export{L as default};
